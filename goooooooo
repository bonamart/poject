Swal.fire({
    title: 'What do you want to do?',
    text: 'Choose an option for this booking',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'Submit Now',
    cancelButtonText: 'Save as Draft',
    reverseButtons: true
}).then((result) => {
    console.log("Swal result:", result); // Log the result object
    let requestStatus = result.isConfirmed ? 1 : 0; // Menentukan status request
    let actionText = result.isConfirmed ? 'submitted' : 'saved as draft';

    console.log("Request Status:", requestStatus);

    // Jalankan POST pertama
    return sendRequest(apiurl + "/" + modname, "POST", {
        requestStatus: requestStatus,
        text: appointmentData.text,
        description: appointmentData.description,
        startDate: appointmentData.startDate,
        endDate: appointmentData.endDate,
        ghm_room_id: appointmentData.ghm_room_id,
        employee_id: appointmentData.employee_id,
        guest: appointmentData.guest,
        family: appointmentData.family
    }).then((response) => {
        console.log("Response from first request:", response);
        
        // Ambil reqid dari response pertama
        let reqid = response.data.id;
        
        // Jika pengguna memilih "Submit Now", jalankan POST kedua
        if (result.isConfirmed) {
            return sendRequest(apiurl + "/submissionrequest/" + reqid + "/" + modelclass, "POST", {
                requestStatus: 1,
                action: actionForm,
                approvalAction: isNaN(parseInt(valapprovalAction)) ? 1 : parseInt(valapprovalAction),
                approvalType: valApprovalType,
            });
        } else {
            return null; // Tidak ada request kedua jika memilih "Save as Draft"
        }
    }).then((response) => {
        // Jika POST kedua dilakukan dan sukses
        if (response && response.status === 'success') {
            e.component._dataSource.reload();
        }

        // Tampilkan pesan sukses setelah semua proses selesai
        Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: `Booking has been ${actionText}.`,
            timer: 2000,
            showConfirmButton: false
        });
    }).catch((error) => {
        // Tangani error untuk POST pertama atau kedua
        console.error("Error occurred:", error);
        Swal.fire({ icon: 'error', title: 'Error', text: error.responseText || 'An error occurred' });
    });
});
