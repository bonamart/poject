onAppointmentFormOpening: function(e) {
    const form = e.form;
    const appointmentData = e.appointmentData;

    console.log('Appointment Data:', appointmentData);

    if (appointmentData.employee_id && typeof appointmentData.employee_id === 'string') {
        appointmentData.employee_id = deserializeFromJSON(appointmentData.employee_id);
    }
    if (appointmentData.guest && typeof appointmentData.guest === 'string') {
        appointmentData.guest = deserializeFromJSON(appointmentData.guest);
    } else if (!appointmentData.guest) {
        appointmentData.guest = [];
    }
    if (appointmentData.family && typeof appointmentData.family === 'string') {
        appointmentData.family = deserializeFromJSON(appointmentData.family);
    } else if (!appointmentData.family) {
        appointmentData.family = [];
    }

    function validateBooking() {
        let guestCount = (form.getEditor("guest")?.option("value") || []).length;
        let familyCount = (form.getEditor("family")?.option("value") || []).length;

        let employeeValue = form.getEditor("employee_id")?.option("value");
        let employeeCount = Array.isArray(employeeValue) ? employeeValue.length : 0;

        let totalGuests = guestCount + familyCount + employeeCount;
        console.log("Total Guests:", totalGuests);

        let selectedRoom = form.getEditor("ghm_room_id")?.option("value");
        let room = roomsWithLocations.find(room => room.id === selectedRoom);
        let roomCapacity = room ? room.roomAccupancy : 0;

        console.log("Room Capacity:", roomCapacity);

        let doneButton = $(".dx-popup-bottom .dx-button.dx-popup-done");

        if (totalGuests > roomCapacity) {
            DevExpress.ui.notify("Jumlah tamu melebihi kapasitas kamar!", "error", 2000);
            doneButton.addClass("dx-state-disabled");
        } else {
            doneButton.removeClass("dx-state-disabled");
        }
    }

    validateBooking();
}
