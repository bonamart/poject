appointmentTooltipTemplate: function(model) {
    const booking = model.appointmentData;
    const room = roomsWithLocations.find(room => room.id === booking.ghm_room_id);
    const roomAccupancy = room?.roomAccupancy || 0;

    // Hitung total orang
    const guestCount = (booking.guest && Array.isArray(booking.guest)) ? booking.guest.length : 0;
    const familyCount = (booking.family && Array.isArray(booking.family)) ? booking.family.length : 0;
    const employeeCount = (booking.employee_id && Array.isArray(booking.employee_id)) ? booking.employee_id.length : 0;
    const totalPeople = guestCount + familyCount + employeeCount;

    // Hitung sisa kapasitas kamar
    const remainingCapacity = Math.max(roomAccupancy - totalPeople, 0);

    // Format tanggal
    const formatDate = (date) => date ? new Date(date).toLocaleDateString("en-CA") : "No Date";

    // ID unik untuk tombol delete
    if (!booking.id) return `<div><b>Invalid Booking</b></div>`;
    const deleteButtonId = `delete-btn-${booking.id}`;

    // Tooltip HTML
    const tooltipHtml = `
        <div>
            <b>Subject: ${booking.text || "No Title"}</b><br>
            ${formatDate(booking.startDate)} - ${formatDate(booking.endDate)}<br>
            <b>Accupancy:</b> ${roomAccupancy} Person<br>
            <b>Booked:</b> ${totalPeople} Person<br>
            <b>Remaining:</b> ${remainingCapacity} Person<br>
            <b>Created By:</b> ${booking.creator || "No Name"}<br><br>
            <button id="${deleteButtonId}" class="btn btn-danger btn-sm">Delete</button>
        </div>
    `;

    // Tambahkan event listener dengan pengecekan elemen ada atau tidak
    setTimeout(() => {
        const deleteButton = document.getElementById(deleteButtonId);
        if (!deleteButton) return;
        deleteButton.addEventListener("click", function(event) {
            event.stopPropagation();
            if (confirm("Are you sure you want to delete this booking?")) {
                sendRequest(apiurl + "/" + modname + "/" + booking.id, "DELETE")
                    .then((response) => {
                        if (response.status === "success") {
                            alert("Booking deleted successfully!");
                            $("#scheduler").dxScheduler("instance").getDataSource().reload();
                        } else {
                            alert("Error: " + (response.message || "Failed to delete booking."));
                        }
                    })
                    .catch((error) => {
                        alert("Error: " + (error.responseText || "Unknown error."));
                    });
            }
        });
    }, 100);

    return tooltipHtml;
}
